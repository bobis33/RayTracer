name: RayTracer CI
run-name: ${{github.actor}} RayTracer CI
on:
  push:
    branches:
      - "**"

env:
  EXECUTABLE: "raytracer"
  LIBRARY: "raytracer_sfml_renderer.so,raytracer_ppm_renderer.so,raytracer_ambient_lights.so,raytracer_directional_lights.so,raytracer_point_lights.so,raytracer_cone_shape.so,raytracer_cylinder_shape.so,raytracer_plane_shape.so,raytracer_sphere_shape.so"

jobs:
  build:
    runs-on: ubuntu-latest
    container:
        image: epitechcontent/epitest-docker:latest

    steps:
      - uses: actions/checkout@v2

      - name: Check compilation
        run: |
          mkdir ./build && cd ./build
          cmake .. -G "Unix Makefiles" -DCMAKE_BUILD_TYPE=Release
          cmake --build .
          cd ..

      - name: Check binary
        run: |
          if [[ ! -x "./${EXECUTABLE}" ]]; then
          echo "Error: Binary ${EXECUTABLE} not found."
          exit 1
          fi

      - name: Check shared libraries
        run: |
          IFS=',' read -ra ADDR <<< $LIBRARY
          for lib in "${ADDR[@]}"; do
            if [[ ! -e "./plugins/${lib}" ]]; then
              echo "Error: Library $lib not found."
              exit 1
            fi
          done
